<!DOCTYPE html>
<html>
	<head>
		<!--[if lt IE 9]>
			<script src="https://html5shim.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]--> 
		<script src='/s/img.js'></script>

		<script src='/s/jquery.js'></script>
		<script src='/s/jquery-file-plugin.js'></script> 
		<script>
		var img = new Image();
		img.src = 's/mario.jpeg';

		img.onload = function() {
			var canvas = document.createElement("canvas");
			new thumbnailer(canvas, img, 188, 3);
		//	console.log(canvas.toDataURL());
		};		

		var rFilter = /^(image\/bmp|image\/cis-cod|image\/gif|image\/ief|image\/jpeg|image\/jpeg|image\/jpeg|image\/pipeg|image\/png|image\/svg\+xml|image\/tiff|image\/x-cmu-raster|image\/x-cmx|image\/x-icon|image\/x-portable-anymap|image\/x-portable-bitmap|image\/x-portable-graymap|image\/x-portable-pixmap|image\/x-rgb|image\/x-xbitmap|image\/x-xpixmap|image\/x-xwindowdump)$/i;
  
		

		function loadImageFile() {
			if (document.getElementById("uploadImage").files.length === 0) { return; }  
			var oFile = document.getElementById("uploadImage").files[0];
			if (!rFilter.test(oFile.type)) { alert("You must select a valid image file!"); return; }
			oFReader.readAsDataURL(oFile); 
		}
	
		//scaler.isSupported
		
		$(function() {
			$('#up').file(function(inp) {
				for(var i = 0; i < inp.files.length; i++) {
					var file = inp.files[i];
					(function(file) {
						var fr = new FileReader();
						fr.readAsDataURL(file);

						fr.onload = function () {
							var img = new Image();
							img.src = fr.result;

							img.onload = function () {
							    var canvas = document.createElement('canvas'), ctx;
							    canvas.width = 188;
							    canvas.height = 150;
							    document.body.appendChild(canvas);
							    ctx = canvas.getContext('2d');
							    ctx.drawImage(img,0,0,188,150);
							};

							/*img.onload = function() {
								var canvas = document.createElement("canvas");
								new thumbnailer(canvas, img, 188, 3);
								document.body.appendChild(canvas);
								console.log('encoded');
								//console.log(canvas.toDataURL());
							};*/
						};
					})(file);
				};
			});	
		});
		</script>
	</head>
	<body>
		<div id='up'>up</div>

		<p>image</p>
		<img src='/s/mario.jpeg'>
	</body>
</html>